{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SocraticAI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user. (Primary Key)"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Session": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Session",
      "type": "object",
      "description": "Represents a single tutoring session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the session. (Primary Key)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Session)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the session started.",
          "format": "date-time"
        },
        "topic": {
          "type": "string",
          "description": "The topic covered in the session (e.g., 'ratios', 'unit conversions')."
        },
        "messages": {
          "type": "array",
          "description": "Array of messages exchanged during the session.",
          "items": {
            "type": "string"
          }
        },
        "keyLearnings": {
          "type": "array",
          "description": "Array of key learning points from the session.",
          "items": {
            "type": "string"
          }
        },
        "summary": {
          "type": "string",
          "description": "Brief summary of what was learned during the session."
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the session has been completed."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "topic",
        "messages",
        "keyLearnings",
        "summary",
        "completed"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of user profiles, each identified by their Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/sessions/{sessionId}",
        "definition": {
          "entityName": "Session",
          "schema": {
            "$ref": "#/backend/entities/Session"
          },
          "description": "Subcollection of user sessions, each identified by an auto-generated session ID.  Includes session topic, messages, key learnings, a summary, and a completion status.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "sessionId",
              "description": "The auto-generated ID of the session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and efficient access to user session data for the SocraticAI tutoring application. It leverages path-based ownership for session data within user profiles, which allows straightforward security rules based on the authenticated user's ID. Denormalization is not required in this design as all session data is private to the user and stored under their user ID. This ensures authorization independence because access control is solely based on the path, not on data stored within the documents. The structure facilitates QAPs (Rules are not Filters) by ensuring each collection (`users/{userId}/sessions`) contains data with the same security requirements."
  }
}